{"componentChunkName":"component---src-templates-post-template-js","path":"/sw_development/spring-boot/rabbitmq-shutdown-timeout/","result":{"data":{"site":{"siteMetadata":{"title":"Louis","author":"Louis"}},"markdownRemark":{"id":"12811544-1e19-58dc-8864-c2292d6fc7ad","excerpt":"스프링 래빗엠큐의 셧다운 시간을 변경하는 방법이다.","html":"<p>스프링 래빗엠큐의 셧다운 시간을 변경하는 방법이다.</p>\n<!-- more -->\n<h1>스프링 래빗엠큐의 셧다운 기본 설정</h1>\n<hr>\n<h2>스프링 애플리케이션의 종료</h2>\n<p>스프링 애플리케이션은 종료 시그널을 받고 셧다운을 시작한다.</p>\n<p>로그 샘플은 아래와 같고,</p>\n<p>로그에서는 래빗엠큐(SimpleBrokerMessageHandler, SimpleMessageListenerContainer), 서블릿 컨테이너(tomcat), 쓰레드풀, DB(Hikari)기 종료되는 것을 볼 수 있다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"log\"><pre class=\"language-log\"><code class=\"language-log\"><span class=\"gatsby-highlight-code-line\"><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:38.729</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>SimpleBrokerMessageHandler <span class=\"token operator\">:</span> Stopping<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></span><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:38.729</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>SimpleBrokerMessageHandler <span class=\"token operator\">:</span> BrokerAvailabilityEvent<span class=\"token punctuation\">[</span>available<span class=\"token operator\">=</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> SimpleBrokerMessageHandler <span class=\"token punctuation\">[</span>DefaultSubscriptionRegistry<span class=\"token punctuation\">[</span>cache<span class=\"token punctuation\">[</span><span class=\"token number\">0</span> destination<span class=\"token operator\">(</span>s<span class=\"token operator\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> registry<span class=\"token punctuation\">[</span><span class=\"token number\">0</span> sessions<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n<span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:38.729</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>m<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>SimpleBrokerMessageHandler <span class=\"token operator\">:</span> Stopped<span class=\"token punctuation\">.</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:38.730</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">.</span>tomcat<span class=\"token punctuation\">.</span>GracefulShutdown <span class=\"token operator\">:</span> Commencing graceful shutdown<span class=\"token punctuation\">.</span> Waiting for active requests to complete</span><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:42.743</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>tomcat<span class=\"token operator\">-</span>shutdown<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>b<span class=\"token punctuation\">.</span>w<span class=\"token punctuation\">.</span>e<span class=\"token punctuation\">.</span>tomcat<span class=\"token punctuation\">.</span>GracefulShutdown <span class=\"token operator\">:</span> Graceful shutdown complete\n<span class=\"gatsby-highlight-code-line\"><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:42.778</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">.</span>l<span class=\"token punctuation\">.</span>SimpleMessageListenerContainer <span class=\"token operator\">:</span> Waiting for workers to finish<span class=\"token punctuation\">.</span></span><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.677</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>a<span class=\"token punctuation\">.</span>r<span class=\"token punctuation\">.</span>l<span class=\"token punctuation\">.</span>SimpleMessageListenerContainer <span class=\"token operator\">:</span> Successfully waited for workers to finish<span class=\"token punctuation\">.</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.688</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>ThreadPoolTaskExecutor <span class=\"token operator\">:</span> Shutting down ExecutorService <span class=\"token string\">'brokerChannelExecutor'</span></span><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.689</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>ThreadPoolTaskScheduler <span class=\"token operator\">:</span> Shutting down ExecutorService <span class=\"token string\">'messageBrokerTaskScheduler'</span>\n<span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.690</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>ThreadPoolTaskExecutor <span class=\"token operator\">:</span> Shutting down ExecutorService <span class=\"token string\">'watcherExecutor'</span>\n<span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.690</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>ThreadPoolTaskExecutor <span class=\"token operator\">:</span> Shutting down ExecutorService <span class=\"token string\">'beelineExecutor'</span>\n<span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.730</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>ThreadPoolTaskExecutor <span class=\"token operator\">:</span> Shutting down ExecutorService <span class=\"token string\">'clientOutboundChannelExecutor'</span>\n<span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.730</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>c<span class=\"token punctuation\">.</span>ThreadPoolTaskExecutor <span class=\"token operator\">:</span> Shutting down ExecutorService <span class=\"token string\">'clientInboundChannelExecutor'</span>\n<span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.765</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> o<span class=\"token punctuation\">.</span>s<span class=\"token punctuation\">.</span>o<span class=\"token punctuation\">.</span>j<span class=\"token punctuation\">.</span>LocalContainerEntityManagerFactoryBean <span class=\"token operator\">:</span> Closing JPA EntityManagerFactory for persistence unit <span class=\"token string\">'default'</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.776</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> com<span class=\"token punctuation\">.</span>zaxxer<span class=\"token punctuation\">.</span>hikari<span class=\"token punctuation\">.</span>HikariDataSource <span class=\"token operator\">:</span> HikariPool<span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> Shutdown initiated<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></span><span class=\"token number\">2024</span><span class=\"token operator\">:</span><span class=\"token number\">09</span><span class=\"token operator\">:</span><span class=\"token number\">01</span> <span class=\"token time number\">00:00:43.828</span> <span class=\"token level info keyword\">INFO</span>  <span class=\"token punctuation\">[</span>SpringContextShutdownHook<span class=\"token punctuation\">]</span> com<span class=\"token punctuation\">.</span>zaxxer<span class=\"token punctuation\">.</span>hikari<span class=\"token punctuation\">.</span>HikariDataSource <span class=\"token operator\">:</span> HikariPool<span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">-</span> Shutdown completed<span class=\"token punctuation\">.</span></code></pre></div>\n<h2>스프링 래빗엠큐의 종료</h2>\n<p>래빗엠큐의 종료가 시작되면,</p>\n<ul>\n<li>메세지는 더 이상 수신하지 않고(SimpleBrokerMessageHandler 에 의해)</li>\n<li>컨슈머가 이미 수신한 메세지 처리를 완료할 수 있도로 기다려준다. 기다리는 최대 시간이 Shutdown Timeout 이다.</li>\n</ul>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"># 코드 참고 <span class=\"token operator\">:</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">/</span>spring<span class=\"token operator\">-</span>projects<span class=\"token operator\">/</span>spring<span class=\"token operator\">-</span>amqp<span class=\"token operator\">/</span>blob<span class=\"token operator\">/</span><span class=\"token number\">1f</span><span class=\"token number\">234</span>cd0ff3a0166c8c69e38cc3f7b3167a90307<span class=\"token operator\">/</span>spring<span class=\"token operator\">-</span>rabbit<span class=\"token operator\">/</span>src<span class=\"token operator\">/</span>main<span class=\"token operator\">/</span>java<span class=\"token operator\">/</span>org<span class=\"token operator\">/</span>springframework<span class=\"token operator\">/</span>amqp<span class=\"token operator\">/</span>rabbit<span class=\"token operator\">/</span>listener<span class=\"token operator\">/</span><span class=\"token class-name\">SimpleMessageListenerContainer</span><span class=\"token punctuation\">.</span>java#L688 \n\n<span class=\"token comment\">// 생략..</span>\n<span class=\"token class-name\">Runnable</span> awaitShutdown <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n  logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Waiting for workers to finish.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">boolean</span> finished <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>cancellationLock<span class=\"token punctuation\">.</span><span class=\"token function\">await</span><span class=\"token punctuation\">(</span><span class=\"token function\">getShutdownTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token punctuation\">.</span>MILLISECONDS<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>finished<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully waited for workers to finish.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      logger<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Workers not finished.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">isForceCloseChannel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>stopNow<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        canceledConsumers<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>consumer <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isWarnEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            logger<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Closing channel for unresponsive consumer: \"</span> <span class=\"token operator\">+</span> consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span>\n          consumer<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">InterruptedException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Thread</span><span class=\"token punctuation\">.</span><span class=\"token function\">currentThread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">interrupt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    logger<span class=\"token punctuation\">.</span><span class=\"token function\">warn</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Interrupted waiting for workers.  Continuing with shutdown.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 생략..</span></code></pre></div>\n<p>Default Shutdown Timeout 은 5초이다. 위 코드에서 getShutdownTimeout()으로 획득되는 값이다.</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 참고 : https://docs.spring.io/spring-amqp/reference/amqp/containerAttributes.html#shutdownTimeout \n\nWhen a container shuts down (for example, if its enclosing ApplicationContext is closed), \nit waits for in-flight messages to be processed up to this limit. \n<span class=\"gatsby-highlight-code-line\">Defaults to five seconds.</span></code></pre></div>\n<h1>스프링 래빗엠큐 셧다운 타임아웃 시간 변경</h1>\n<p>5초 안에 대부분의 작업이 완료되지만, 그렇지 못한 특이 상황(비즈로직, 서버스펙, 외부연동 지연, 재시도 지연 등)도 있을 수 있으므로 시간을 변경하는 방법을 알아본다.</p>\n<ul>\n<li>코틀린</li>\n</ul>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token annotation builtin\">@Bean</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">rabbitListenerContainerFactory</span><span class=\"token punctuation\">(</span>\n    connectionFactory<span class=\"token operator\">:</span> ConnectionFactory<span class=\"token punctuation\">,</span>\n    configurer<span class=\"token operator\">:</span> SimpleRabbitListenerContainerFactoryConfigurer\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> SimpleRabbitListenerContainerFactory <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">val</span> factory <span class=\"token operator\">=</span> <span class=\"token function\">SimpleRabbitListenerContainerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    configurer<span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">,</span> connectionFactory<span class=\"token punctuation\">)</span>\n    factory<span class=\"token punctuation\">.</span><span class=\"token function\">setContainerCustomizer</span> <span class=\"token punctuation\">{</span> c<span class=\"token operator\">:</span> SimpleMessageListenerContainer <span class=\"token operator\">-></span>\n<span class=\"gatsby-highlight-code-line\">        c<span class=\"token punctuation\">.</span><span class=\"token function\">setShutdownTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span> # <span class=\"token number\">10</span>초로 변경</span>    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> factory\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>자바</li>\n</ul>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Bean</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">SimpleRabbitListenerContainerFactory</span> <span class=\"token function\">rabbitListenerContainerFactory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">ConnectionFactory</span> connectionFactory<span class=\"token punctuation\">,</span>\n     <span class=\"token keyword\">final</span> <span class=\"token class-name\">SimpleRabbitListenerContainerFactoryConfigurer</span> configurer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token class-name\">SimpleRabbitListenerContainerFactory</span> factory <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">SimpleRabbitListenerContainerFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  configurer<span class=\"token punctuation\">.</span><span class=\"token function\">configure</span><span class=\"token punctuation\">(</span>factory<span class=\"token punctuation\">,</span> connectionFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  factory<span class=\"token punctuation\">.</span><span class=\"token function\">setContainerCustomizer</span><span class=\"token punctuation\">(</span>c <span class=\"token operator\">-></span> c<span class=\"token punctuation\">.</span><span class=\"token function\">setShutdownTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> # <span class=\"token number\">10</span>초로 변경</span>  <span class=\"token keyword\">return</span> factory<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h1>기타</h1>\n<ul>\n<li>ChatGPT 4o가 아래와 같이 알려주는데 동작안한다. (24년 9월 1일 기준)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"># 동작하지 않는 코드\n## springVersion <span class=\"token number\">2.3</span><span class=\"token punctuation\">.</span><span class=\"token number\">12</span><span class=\"token punctuation\">.</span>RELEASE\n## org<span class=\"token punctuation\">.</span>springframework<span class=\"token punctuation\">.</span>amqp<span class=\"token operator\">:</span>spring<span class=\"token operator\">-</span>rabbit<span class=\"token operator\">:</span><span class=\"token number\">2.2</span><span class=\"token punctuation\">.</span><span class=\"token number\">18</span><span class=\"token punctuation\">.</span>RELEASE\n<span class=\"token annotation builtin\">@Bean</span>\n<span class=\"token keyword\">fun</span> <span class=\"token function\">container</span><span class=\"token punctuation\">(</span>connectionFactory<span class=\"token operator\">:</span> ConnectionFactory<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> SimpleMessageListenerContainer <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">val</span> container <span class=\"token operator\">=</span> <span class=\"token function\">SimpleMessageListenerContainer</span><span class=\"token punctuation\">(</span>connectionFactory<span class=\"token punctuation\">)</span>\n  container<span class=\"token punctuation\">.</span><span class=\"token function\">setShutdownTimeout</span><span class=\"token punctuation\">(</span><span class=\"token number\">30000</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 5초 동안 graceful shutdown 대기</span>\n  <span class=\"token keyword\">return</span> container\n<span class=\"token punctuation\">}</span></code></pre></div>","fields":{"slug":"/sw_development/spring-boot/rabbitmq-shutdown-timeout/"},"frontmatter":{"title":"RabbitMQ 셧다운 시간 설정하기","searchTexts":["rabbitmq","래빗엠큐"],"category":"sw development","subCategory":"spring boot","tags":["spring boot","queue","message processing"],"created":"Sep 01, 2024","updated":"Sep 01, 2024"},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%9E%98%EB%B9%97%EC%97%A0%ED%81%90%EC%9D%98-%EC%85%A7%EB%8B%A4%EC%9A%B4-%EA%B8%B0%EB%B3%B8-%EC%84%A4%EC%A0%95\">스프링 래빗엠큐의 셧다운 기본 설정</a></p>\n<ul>\n<li><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%98-%EC%A2%85%EB%A3%8C\">스프링 애플리케이션의 종료</a></li>\n<li><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%9E%98%EB%B9%97%EC%97%A0%ED%81%90%EC%9D%98-%EC%A2%85%EB%A3%8C\">스프링 래빗엠큐의 종료</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%9E%98%EB%B9%97%EC%97%A0%ED%81%90-%EC%85%A7%EB%8B%A4%EC%9A%B4-%ED%83%80%EC%9E%84%EC%95%84%EC%9B%83-%EC%8B%9C%EA%B0%84-%EB%B3%80%EA%B2%BD\">스프링 래빗엠큐 셧다운 타임아웃 시간 변경</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B8%B0%ED%83%80\">기타</a></p>\n</li>\n</ul>"}},"pageContext":{"slug":"/sw_development/spring-boot/rabbitmq-shutdown-timeout/","prev":{"fields":{"slug":"/sw_development/troubleshooting/python-pyenv-install-error-on-macos-m1/"},"frontmatter":{"title":"Mac M1 pyenv 3.12.4 설치 오류","tags":["MacOS Setup","Python"],"category":"sw development","subCategory":"troubleshooting"}},"next":{"fields":{"slug":"/sw_development/setup/mac-os-hadoop-installation/"},"frontmatter":{"title":"MacOS Hadoop 설치하기","tags":["MacOS Setup","K8S","Hadoop"],"category":"sw development","subCategory":"setup"}}}},"staticQueryHashes":["2152785458","3427181268"]}